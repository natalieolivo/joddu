import React, { useState } from "react";
import styled from "styled-components";
import MenuButton from "../svgs/MenuButton";
import { Link } from "@reach/router";
import config from "../config";

const AUTH_SIGNOUT_ENDPOINT = config.AUTH_SIGNOUT_ENDPOINT || "";

const Nav = styled.nav`
  display: flex;
  background: ${props => props.theme.headerBg};
  font-size: 1em;
  justify-content: center;
  align-items: center;
  min-height: 3rem;

  svg {
    padding: 0.4rem;
    position: fixed;
    top: 0;
    left: 0;
  }
`;

Nav.defaultProps = {
  theme: {
    main: "neutral",
    bg: "brown"
  }
};

const List = styled.section`
  margin: 0;
  padding: 0;
  position: absolute;
  z-index: 10;
  top: 4.5em;
  left: 0.4em;
  right: 0.4em;
  color: #000;
  background: #fff;
  border: solid 1px #ddd;
  border-radius: 8px;
  box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
`;

const ListItems = styled.ul`
  list-style: none;
`;

const Logo = styled.div`
  color: #000;
  font-size: 1.2rem;
  font-weight: 900;
  padding: 0.4rem 0 0 5.5rem;
`;

const HeaderLinkList = styled.section`
  margin: 0 0.9em 0 auto;
  cursor: pointer;
  color: #fff;
  text-transform: uppercase;
  font-size: 1rem;
`;

const userInfo =
  localStorage.getItem("ut") && JSON.parse(localStorage.getItem("ut"));

const Menu = React.forwardRef((props, ref) => {
  console.log(ref);
  let [menuVisible, setMenuVisible] = useState(false);

  const menuDisplay = () => {
    if (menuVisible) {
      return (
        <List>
          <ListItems>
            <li>
              <Link to="/home">Home</Link>
            </li>
            <li>
              <Link to="/stylists/register">Stylists Register</Link>
            </li>
            <li>
              <Link to="/appointments">Appointments</Link>
            </li>
            <li>
              <Link to="/signin">Signin</Link>
            </li>
          </ListItems>
        </List>
      );
    }
  };

  const setMenuDisplay = event => {
    setMenuVisible(!menuVisible);

    const closeMenu = event => {
      if (event.target.className !== "App") return;

      setMenuVisible(false);
    };

    if (!menuVisible) {
      ref.current.addEventListener("click", closeMenu);
    } else {
      ref.current.removeEventListener("click", closeMenu);
    }
  };

  const onSignout = () => {
    // remove stored token
    localStorage.clear();

    // TODO: Add message indicating signout
    fetch(AUTH_SIGNOUT_ENDPOINT)
      .then(response => response.json())
      .then(json => console.log("logged out", json))
      .catch(e => {
        console.log(e);
      });
  };

  const HeaderLinks = () => {
    if (userInfo && userInfo.token) {
      return <span onClick={onSignout}>Sign Out ({userInfo.name})</span>;
    } else {
      return <Link to="/signin">Sign In</Link>;
    }
  };

  return (
    <Nav>
      {/* <MenuButton setMenuDisplay={setMenuDisplay} /> */}
      <svg
        width="71px"
        height="91px"
        viewBox="0 0 71 91"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlnsXlink="http://www.w3.org/1999/xlink"
      >
        <title>Rectangle</title>
        <desc>Created with Sketch.</desc>
        <g
          id="Symbols"
          stroke="none"
          stroke-width="1"
          fill="none"
          fill-rule="evenodd"
        >
          <g id="Block-S">
            <g>
              <g>
                <path
                  d="M26,0 L45.5610509,0 C59.6105945,-1.32390003e-14 71,11.3894055 71,25.4389491 L71,25.4389491 L71,25.4389491 L71,65 C71,79.3594035 59.3594035,91 45,91 L26,91 C11.6405965,91 1.75851975e-15,79.3594035 0,65 L0,26 C-1.75851975e-15,11.6405965 11.6405965,2.63777963e-15 26,0 Z"
                  id="Rectangle"
                  fill="#AA0F20"
                ></path>
                <g
                  id="Group"
                  transform="translate(13.500000, 13.975610)"
                  fill="#769075"
                >
                  <rect
                    id="Rectangle"
                    x="0"
                    y="0"
                    width="45"
                    height="12.7154472"
                  ></rect>
                  <rect
                    id="Rectangle"
                    x="0"
                    y="3.7398374"
                    width="16.5"
                    height="12.7154472"
                  ></rect>
                  <rect
                    id="Rectangle"
                    x="28.5"
                    y="3.7398374"
                    width="16.5"
                    height="12.7154472"
                  ></rect>
                </g>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  x="13.5"
                  y="37.9105691"
                  width="45"
                  height="12.7154472"
                ></rect>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  x="13.5"
                  y="31.9268293"
                  width="16.5"
                  height="12.7154472"
                ></rect>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  x="42"
                  y="42.398374"
                  width="16.5"
                  height="12.7154472"
                ></rect>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  transform="translate(36.000000, 66.707317) rotate(-180.000000) translate(-36.000000, -66.707317) "
                  x="13.5"
                  y="60.3495935"
                  width="45"
                  height="12.7154472"
                ></rect>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  transform="translate(50.250000, 62.967480) rotate(-180.000000) translate(-50.250000, -62.967480) "
                  x="42"
                  y="56.6097561"
                  width="16.5"
                  height="12.7154472"
                ></rect>
                <rect
                  id="Rectangle"
                  fill="#769075"
                  transform="translate(21.750000, 62.967480) rotate(-180.000000) translate(-21.750000, -62.967480) "
                  x="13.5"
                  y="56.6097561"
                  width="16.5"
                  height="12.7154472"
                ></rect>
              </g>
            </g>
            <g
              id="Comb-teeth"
              transform="translate(14.000000, 63.000000)"
              fill="#AA0F20"
            >
              <path
                d="M0.570465116,0 L1.1775969,0 C1.27878553,4.63157895 1.27878553,7.71929825 1.1775969,9.26315789 C1.02581395,11.5789474 0.722248062,11.5789474 0.570465116,9.26315789 C0.469276486,7.71929825 0.469276486,4.63157895 0.570465116,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M2.08829457,0 L2.69542636,0 C2.79661499,4.63157895 2.79661499,7.71929825 2.69542636,9.26315789 C2.54364341,11.5789474 2.24007752,11.5789474 2.08829457,9.26315789 C1.98710594,7.71929825 1.98710594,4.63157895 2.08829457,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M3.60612403,0 L4.21325581,0 C4.31444444,4.63157895 4.31444444,7.71929825 4.21325581,9.26315789 C4.06147287,11.5789474 3.75790698,11.5789474 3.60612403,9.26315789 C3.5049354,7.71929825 3.5049354,4.63157895 3.60612403,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M5.12395349,0 L5.73108527,0 C5.8322739,4.63157895 5.8322739,7.71929825 5.73108527,9.26315789 C5.57930233,11.5789474 5.27573643,11.5789474 5.12395349,9.26315789 C5.02276486,7.71929825 5.02276486,4.63157895 5.12395349,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M6.64178295,0 L7.24891473,0 C7.35010336,4.63157895 7.35010336,7.71929825 7.24891473,9.26315789 C7.09713178,11.5789474 6.79356589,11.5789474 6.64178295,9.26315789 C6.54059432,7.71929825 6.54059432,4.63157895 6.64178295,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M8.1596124,0 L8.76674419,0 C8.86793282,4.63157895 8.86793282,7.71929825 8.76674419,9.26315789 C8.61496124,11.5789474 8.31139535,11.5789474 8.1596124,9.26315789 C8.05842377,7.71929825 8.05842377,4.63157895 8.1596124,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M9.67744186,0 L10.2845736,0 C10.3857623,4.63157895 10.3857623,7.71929825 10.2845736,9.26315789 C10.1327907,11.5789474 9.82922481,11.5789474 9.67744186,9.26315789 C9.57625323,7.71929825 9.57625323,4.63157895 9.67744186,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M11.1952713,0 L11.8024031,0 C11.9035917,4.63157895 11.9035917,7.71929825 11.8024031,9.26315789 C11.6506202,11.5789474 11.3470543,11.5789474 11.1952713,9.26315789 C11.0940827,7.71929825 11.0940827,4.63157895 11.1952713,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M12.7131008,0 L13.3202326,0 C13.4214212,4.63157895 13.4214212,7.71929825 13.3202326,9.26315789 C13.1684496,11.5789474 12.8648837,11.5789474 12.7131008,9.26315789 C12.6119121,7.71929825 12.6119121,4.63157895 12.7131008,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M14.2309302,0 L14.838062,0 C14.9392506,4.63157895 14.9392506,7.71929825 14.838062,9.26315789 C14.6862791,11.5789474 14.3827132,11.5789474 14.2309302,9.26315789 C14.1297416,7.71929825 14.1297416,4.63157895 14.2309302,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M15.7487597,0 L16.3558915,0 C16.4570801,4.63157895 16.4570801,7.71929825 16.3558915,9.26315789 C16.2041085,11.5789474 15.9005426,11.5789474 15.7487597,9.26315789 C15.6475711,7.71929825 15.6475711,4.63157895 15.7487597,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M17.2665891,0 L17.8737209,0 C17.9749096,4.63157895 17.9749096,7.71929825 17.8737209,9.26315789 C17.721938,11.5789474 17.4183721,11.5789474 17.2665891,9.26315789 C17.1654005,7.71929825 17.1654005,4.63157895 17.2665891,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M18.7844186,0 L19.3915504,0 C19.492739,4.63157895 19.492739,7.71929825 19.3915504,9.26315789 C19.2397674,11.5789474 18.9362016,11.5789474 18.7844186,9.26315789 C18.68323,7.71929825 18.68323,4.63157895 18.7844186,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M20.3022481,0 L20.9093798,0 C21.0105685,4.63157895 21.0105685,7.71929825 20.9093798,9.26315789 C20.7575969,11.5789474 20.454031,11.5789474 20.3022481,9.26315789 C20.2010594,7.71929825 20.2010594,4.63157895 20.3022481,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M21.8200775,0 L22.4272093,0 C22.5283979,4.63157895 22.5283979,7.71929825 22.4272093,9.26315789 C22.2754264,11.5789474 21.9718605,11.5789474 21.8200775,9.26315789 C21.7188889,7.71929825 21.7188889,4.63157895 21.8200775,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M23.337907,0 L23.9450388,0 C24.0462274,4.63157895 24.0462274,7.71929825 23.9450388,9.26315789 C23.7932558,11.5789474 23.4896899,11.5789474 23.337907,9.26315789 C23.2367183,7.71929825 23.2367183,4.63157895 23.337907,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M24.8557364,0 L25.4628682,0 C25.5640568,4.63157895 25.5640568,7.71929825 25.4628682,9.26315789 C25.3110853,11.5789474 25.0075194,11.5789474 24.8557364,9.26315789 C24.7545478,7.71929825 24.7545478,4.63157895 24.8557364,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M26.3735659,0 L26.9806977,0 C27.0818863,4.63157895 27.0818863,7.71929825 26.9806977,9.26315789 C26.8289147,11.5789474 26.5253488,11.5789474 26.3735659,9.26315789 C26.2723773,7.71929825 26.2723773,4.63157895 26.3735659,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M27.8913953,0 L28.4985271,0 C28.5997158,4.63157895 28.5997158,7.71929825 28.4985271,9.26315789 C28.3467442,11.5789474 28.0431783,11.5789474 27.8913953,9.26315789 C27.7902067,7.71929825 27.7902067,4.63157895 27.8913953,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M29.4092248,0 L30.0163566,0 C30.1175452,4.63157895 30.1175452,7.71929825 30.0163566,9.26315789 C29.8645736,11.5789474 29.5610078,11.5789474 29.4092248,9.26315789 C29.3080362,7.71929825 29.3080362,4.63157895 29.4092248,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M30.9270543,0 L31.534186,0 C31.6353747,4.63157895 31.6353747,7.71929825 31.534186,9.26315789 C31.3824031,11.5789474 31.0788372,11.5789474 30.9270543,9.26315789 C30.8258656,7.71929825 30.8258656,4.63157895 30.9270543,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M32.4448837,0 L33.0520155,0 C33.1532041,4.63157895 33.1532041,7.71929825 33.0520155,9.26315789 C32.9002326,11.5789474 32.5966667,11.5789474 32.4448837,9.26315789 C32.3436951,7.71929825 32.3436951,4.63157895 32.4448837,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M33.9627132,0 L34.569845,0 C34.6710336,4.63157895 34.6710336,7.71929825 34.569845,9.26315789 C34.418062,11.5789474 34.1144961,11.5789474 33.9627132,9.26315789 C33.8615245,7.71929825 33.8615245,4.63157895 33.9627132,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M35.4805426,0 L36.0876744,0 C36.188863,4.63157895 36.188863,7.71929825 36.0876744,9.26315789 C35.9358915,11.5789474 35.6323256,11.5789474 35.4805426,9.26315789 C35.379354,7.71929825 35.379354,4.63157895 35.4805426,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M36.9983721,0 L37.6055039,0 C37.7066925,4.63157895 37.7066925,7.71929825 37.6055039,9.26315789 C37.4537209,11.5789474 37.150155,11.5789474 36.9983721,9.26315789 C36.8971835,7.71929825 36.8971835,4.63157895 36.9983721,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M38.5162016,0 L39.1233333,0 C39.224522,4.63157895 39.224522,7.71929825 39.1233333,9.26315789 C38.9715504,11.5789474 38.6679845,11.5789474 38.5162016,9.26315789 C38.4150129,7.71929825 38.4150129,4.63157895 38.5162016,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M40.034031,0 L40.6411628,0 C40.7423514,4.63157895 40.7423514,7.71929825 40.6411628,9.26315789 C40.4893798,11.5789474 40.185814,11.5789474 40.034031,9.26315789 C39.9328424,7.71929825 39.9328424,4.63157895 40.034031,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M43.0696899,0 L43.6768217,0 C43.7780103,4.63157895 43.7780103,7.71929825 43.6768217,9.26315789 C43.5250388,11.5789474 43.2214729,11.5789474 43.0696899,9.26315789 C42.9685013,7.71929825 42.9685013,4.63157895 43.0696899,0 Z"
                id="Rectangle"
              ></path>
              <path
                d="M41.5518605,0 L42.1589922,0 C42.2601809,4.63157895 42.2601809,7.71929825 42.1589922,9.26315789 C42.0072093,11.5789474 41.7036434,11.5789474 41.5518605,9.26315789 C41.4506718,7.71929825 41.4506718,4.63157895 41.5518605,0 Z"
                id="Rectangle"
              ></path>
            </g>
          </g>
        </g>
      </svg>
      {menuDisplay()}
      <Logo>Snatched</Logo>
      <HeaderLinkList>
        <HeaderLinks />
      </HeaderLinkList>
    </Nav>
  );
});

export default Menu;
